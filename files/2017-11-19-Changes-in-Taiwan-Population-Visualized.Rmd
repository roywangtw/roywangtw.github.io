---
title: "Changes in Taiwan Population Visualized"
author: "Roy Wang"
date: "Nov 19, 2017"
tags: [Taiwan, R programming, data visualization]
output:
  html_notebook:
    toc: yes
---

### 1. Introduction

Taiwan's society has been going through massive fundamental shifts during the past decade, and changes to its population structure is one of them. Here, we analyze Taiwan population data from 2004 to 2016 for interesting, noteworthy trends and phenomena.

Our pick of 2004 as the beginning year is mainly because it was when the data became available for classification of children population based on their biological mothers' nationalities.

***

### 2. Data retrieval and manipulation

The Taiwan population data for our analysis are published and updated periodically by the Ministry of the Interior, Taiwan (R.O.C.) and can be downloaded [here](http://sowf.moi.gov.tw/stat/month/m1-02.xls).  

Since the complete annual data for 2017 are not yet available, we cannot make fair, meaningful comparison with data from previous years. In this case, the data we use will be up till 2016 only.

A quick scan of the original raw data online offers some critical information:

- The entire spreadsheet follows a mostly consistent format with only slight differences.

- Data in the rows of the Taiwan Province and Fuchien Province are just aggregations of their respective constituent counties, rendering them redundant here and therefore will be removed from our dataset when we read the spreadsheet data into R.

- The first column of each sheet contains all the names of Taiwan administrative regions, i.e. the chief subjects of our data exploration later on.

- Towards the end of 2010 and 2014, several changes in Taiwan administrative structure led to the merging and upgrading of several cities and counties. Hence, the resulting mismatches in administrative naming and row ordering will have to be handled, before we combine everything together for further exploration.

```{r, message=FALSE}
library(readxl)
file.name <- "tpop.xls" # Set up an object of file name for reuse
cell.range1 <- "A10:AX35" # Set up an object of cell range (2004~2006) for reuse
cell.range2 <- "A9:AX34" # Set up an object of cell range (2007~2010) for reuse
cell.range3 <- "A8:AX31" # Set up an object of cell range (2011~2016) for reuse
download.file(url = "http://sowf.moi.gov.tw/stat/month/m1-02.xls", file.name, mode = "w") # Download the spreadsheet file
# Read the spreadsheet data for each year into R and remove the 2 redundant provincial rows
df2004 <- read_excel(file.name, "2004", range = cell.range1, col_names = FALSE)[-24, ]
df2005 <- read_excel(file.name, "2005", range = cell.range1, col_names = FALSE)[-24, ]
df2006 <- read_excel(file.name, "2006", range = cell.range1, col_names = FALSE)[-24, ]
df2007 <- read_excel(file.name, "2007", range = cell.range2, col_names = FALSE)[-24, ]
df2008 <- read_excel(file.name, "2008", range = cell.range2, col_names = FALSE)[-24, ]
df2009 <- read_excel(file.name, "2009", range = cell.range2, col_names = FALSE)[-24, ]
df2010 <- read_excel(file.name, "2010", range = cell.range2, col_names = FALSE)[-24, ]
df2011 <- read_excel(file.name, "2011", range = cell.range3, col_names = FALSE)[-c(6, 22), ]
df2012 <- read_excel(file.name, "2012", range = cell.range3, col_names = FALSE)[-c(6, 22), ]
df2013 <- read_excel(file.name, "2013", range = cell.range3, col_names = FALSE)[-c(6, 22), ]
df2014 <- read_excel(file.name, "2014", range = cell.range3, col_names = FALSE)[-c(6, 22), ]
df2015 <- read_excel(file.name, "2015", range = cell.range3, col_names = FALSE)[-c(7, 22), ]
df2016 <- read_excel(file.name, "2016", range = cell.range3, col_names = FALSE)[-c(7, 22), ]
```

The first column of each year's dataset contains both the Chinese and English names of Taiwan's administrative regions, thus requiring some cleaning.

```{r}
for(i in list(df2004, df2011, df2015)){
  print(i[, 1])
}
```

The results above also show the mismatches in administrative naming and ordering caused by past changes to Taiwan administrative structure as mentioned earlier. Therefore, we create 3 different character vectors of administrative region names based on the data from 2004, 2011, and 2015.  

```{r}
library(stringr)
library(dplyr)
adm.names.2004 <- str_split(df2004[, 1], fixed(", "), simplify = TRUE) %>% # Extract only the English names
  str_extract_all("[A-Z].*\\s[A-Z].*") %>% 
  str_replace_all("\"[:punct:]?", "") %>% 
  print()
adm.names.2011 <- str_split(df2011[, 1], fixed(", "), simplify = TRUE) %>% # Extract only the English names
  str_extract_all("[A-Z].*\\s[A-Z].*") %>% 
  str_replace_all("\"[:punct:]?", "") %>% 
  print()
adm.names.2015 <- str_split(df2015[, 1], fixed(", "), simplify = TRUE) %>% # Extract only the English names
  str_extract_all("[A-Z].*\\s[A-Z].*") %>% 
  str_replace_all("\"[:punct:]?", "") %>% 
  print()
```

We then replace the first column in each year's dataset with the appropriate version of English administrative region names. 

```{r}
# Replace the first columns in each year's dataset with the appropriate version of character vector
df.list1 <- list(df2004, df2005, df2006, df2007, df2008, df2009, df2010)
df.list1 <- lapply(df.list1, function(df){
  df[, 1] <- adm.names.2004
  return(df)
})
df.list2 <- list(df2011, df2012, df2013, df2014)
df.list2 <- lapply(df.list2, function(df){
  df[, 1] <- adm.names.2011
  return(df)
})
df.list3 <- list(df2015, df2016)
df.list3 <- lapply(df.list3, function(df){
  df[, 1] <- adm.names.2015
  return(df)
})
# Combine all datasets into one single list
df.list <- c(df.list1, df.list2, df.list3)
# Extract the diffrences in the name lists of administrative regions
setdiff(df.list[[7]][, 1], df.list[[12]][, 1]) 
setdiff(df.list[[11]][, 1], df.list[[12]][, 1])
```

The mismatches in the name lists of 2010 and 2016 seen here, of course, arise from the changes in Taiwan administrative structure towards the end of 2010. 

More specifically, 'Taipei County' and 'Taichung County' were both upgraded to special municipality, with the former having its name changed to 'New Taipei City' and the latter merging with 'Taichung City.' In addition, 'Tainan County' merged with 'Tainan City,' and 'Kaohsiung County' merged with 'Kaohsiung City.'

As for the 'Taoyuan County' appearing in both the 2010 and 2014 datasets, it was upgraded to special municipality at the end of 2014 and renamed 'Taoyuan City,' which is included in the 2015 and 2016 datasets. 

To reconcile between the differences in datasets and make them easily comparable, we replace the old English city names with their current names as well. 

```{r}
# Rename 'Taipei County' as 'New Taipei City' and 'Taoyuan County' as 'Taoyuan City'
df.list <- lapply(df.list, function(df){
  df[which(df[, 1] == "Taipei County"), 1] <- "New Taipei City"
  df[which(df[, 1] == "Taoyuan County"), 1] <- "Taoyuan City"
  return(df)
})
```

Moreover, due to the 3 city-county mergers at the end of 2010, the 'Tainan City' in our post-2010 datasets actually refers to the product of merging the old 'Tainan City' and 'Tainan County.' The same goes for 'Taichung City' and 'Kaohsiung City.' 

To make that distinction clear, we append a '(SM)' to all the post-2010 'Taichung City,' 'Tainan City,' and 'Kaohsiung City' to highlight the fact that they are all special municipalities born out of city-county mergers.

```{r}
# Mark the names of the 3 special municipalities with a '(SM)' for better distinction
df.list[c(8:13)] <- lapply(df.list[c(8:13)], function(df){
  df[which(df[, 1] == "Taichung City"), 1] <- "Taichung City (SM)"
  df[which(df[, 1] == "Tainan City"), 1] <- "Tainan City (SM)"
  df[which(df[, 1] == "Kaohsiung City"), 1] <- "Kaohsiung City (SM)"
  return(df)
})
```

Furthermore, to enable easy comparisons between periods before and after the city-county mergers in our data exploration later on, for all the datasets before 2011, we add up the data of each city-county pair and create a new row representing the hypothetical merged entity.

```{r}
# Create new rows of data representing the hypothetical merged entities
df.list[c(1:7)] <- lapply(df.list[c(1:7)], function(df){
  taichung <- df[c(which(df[, 1] == "Taichung City"), which(df[, 1] == "Taichung County")), c(2:ncol(df))]
  taichung.merged <- taichung[1, ] + taichung[2, ]
  taichung.row <- cbind("X__1" = "Taichung City (SM)", taichung.merged)
  tainan <- df[c(which(df[, 1] == "Tainan City"), which(df[, 1] == "Tainan County")), c(2:ncol(df))]
  tainan.merged <- tainan[1, ] + tainan[2, ]
  tainan.row <- cbind("X__1" = "Tainan City (SM)", tainan.merged)
  kaohsiung <- df[c(which(df[, 1] == "Kaohsiung City"), which(df[, 1] == "Kaohsiung County")), c(2:ncol(df))]
  kaohsiung.merged <- kaohsiung[1, ] + kaohsiung[2, ]
  kaohsiung.row <- cbind("X__1" = "Kaohsiung City (SM)", kaohsiung.merged)
  df <- rbind(df, taichung.row, tainan.row, kaohsiung.row)
  return(df)
})
```

And then we add a year column to each year's dataset.

```{r}
# Add a year column 
year <- 2003
for(i in 1:length(df.list)){
  year.column <- rep(year + i, nrow(df.list[[i]]))
  df.list[[i]] <- cbind(year.column, df.list[[i]])
}
```

Next, we add the appropriate column names.

For the column names, a few of those in the original raw data are slightly modified for more straightforward interpretation.[^1]

```{r}
# Create a vector of the appropriate column names
df.colnames <- c("Year", "Adm. Names", "Total No. of Births", "Crude Birth Rates", "No. of Male Births", "No. of Female Births", "Total No. of Deaths", "Crude Death Rates", "No. of Male Deaths", "No. of Female Deaths", "No. of Natural Increases", "Natural Increase Rates", "No. of Social Increases", "Social Increase Rates", "Total No. of Increases", "Total Increase Rates", "No. of Marriages", "Crude Marriage Rates", "No. of Divorces", "Crude Divorce Rates", "Total No. of Legit Births", "No. of Legit Male Births", "No. of Legit Female Births", "Total No. of Adopted Illegit Births", "No. of Adopted Illegit Male Births", "No. of Adopted Illegit Female Births", "Total No. of Unadopted Illegit Births", "No. of Unadopted Illegit Male Births", "No. of Unadopted Illegit Female Births", "Total No. of Abandoned Births", "No. of Abandoned Male Births", "No. of Abandoned Female Births", "Total No. of Transnational Marriages", "No. of Male Transnational Marriages", "No. of Female Transnational Marriages", "Total No. of Transnational Divorces", "No. of Male Transnational Divorces", "No. of Female Transnational Divorces", "Total No. of Births by TW Moms", "Percentage of Births by TW Moms", "No. of Male Births by TW Moms", "No. of Female Births by TW Moms", "Total No. of Births by Non-TW Moms", "No. of Male Births by Non-TW Moms", "No. of Female Births by Non-TW Moms", "Total No. of Births by M.HK.M. Moms", "No. of Male Births by M.HK.M. Moms", "No. of Female Births by M.HK.M. Moms", "Total No. of Births by Foreigner Moms", "No. of Male Births by Foreigner Moms", "No. of Female Births by Foreigner Moms")
# Add the column names to each dataset
df.list <- lapply(df.list, function(df){
  colnames(df) <- df.colnames
  return(df)
})
```

Finally, our entire list of datasets is converted into one big data frame. 

```{r}
df.total <- do.call(rbind, df.list)
```

That's it for all the data manipulation work!

Let's take a quick look at our entire dataset.

```{r}
str(df.total)
```

***

### 3. Data exploration and visualization

Let's start the exploration by diving into the birth data.

```{r}
# Create a new data frame without data of the old city names
df.total.sm <- df.total[-c(which(df.total[, 2] == "Taichung City"), which(df.total[, 2] == "Taichung County"), which(df.total[, 2] == "Tainan City"), which(df.total[, 2] == "Tainan County"), which(df.total[, 2] == "Kaohsiung City"), which(df.total[, 2] == "Kaohsiung County")), ]
library(ggplot2)
library(RColorBrewer)
colors <- colorRampPalette(brewer.pal(8, "Accent")) # Generate a function that produces the necessary number of different colors
ggplot(df.total.sm, aes(`No. of Male Births`, `No. of Female Births`, col = `Adm. Names`)) + # Plot the numbers of male and female births of all administrative regions
  geom_point(alpha = 0.6, size = 5) +
  geom_abline(col = "black", size = 1) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(hjust = 1, size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Male and Female Births in Taiwan Administrative Regions (2004 - 2016)")
```

Two interesting things pop out from the plot above:

1. ***Taiwan as a country has slightly more male births than female births***: As statistically perplexing as it might sound, this, in fact, aligns with the global sex ratio at birth of 107 male births per 100 female births, as reported by the [World Bank](https://data.worldbank.org/indicator/SP.POP.BRTH.MF?view=chart). Virtually no points on the plot sits significantly above the black 45-degree gender parity line, which testifies to the robustness of such sex disparity phenomenon across Taiwan.

2. ***The larger the number of births in a certain administrative region, the bigger the gap between the numbers of male and female births.***: New Taipei City has consistently by far the highest numbers of births, regardless of gender. However, *the disparity between the numbers of male and female births there is the largest as well*, as evidenced by the wider gaps between the city's dark blue points and the black 45-degree gender parity line. In contrast, the regions with the lowest numbers of births (e.g. Lienchaing County, Kinmen County, Penghu County) are surprisingly more gender balanced. In fact, other more metropolitan areas like Taipei City and Taichung City also exhibit such bias towards male births. This probably goes directly against what many people would have guessed without looking at the data; one would assume the populous urban areas, with a relatively higher average of education level and better access to advanced medical treatments, are more likely to have less gender imbalance in child births, while the more rural places would show a stronger inclination towards male newborns. Instead, here we observe the opposite.

```{r}
ggplot(df.total.sm, aes(`No. of Male Deaths`, `No. of Female Deaths`, col = `Adm. Names`, size = `Total No. of Deaths`)) +
  geom_point(alpha = 0.6) +
  geom_abline(col = "black", size = 1) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Male and Female Deaths in Taiwan Administrative Regions (2004 - 2016)")
```

The numbers of male deaths versus female deaths paint an even more intriguing picture. 

1. ***Taiwan as a country has witnessed a much higher death count for men than women***: All the points on the plot are beneath the 45-degree parity line

2. ***The gender differences in death counts are much more prononunced in the most populous regions***: Apparently, in New Taipei City, Kaohsiung City (SM), and Taichung City (SM), 3 of the most highly populated administrative regions (as indicated by the larger sizes of their points), men on average have been dying at a glaringly higher number than women.

```{r}
ggplot(df.total.sm, aes(`No. of Marriages`, `Total No. of Births`, col = `Adm. Names`)) + # Plot the numbers of births against those of marriages in all administrative regions
  geom_point(alpha = 0.6, size = 2) +
  labs(x = "Number of Marriages") +
  geom_abline(col = "black", size = 1) +
  geom_abline(col = "darkgrey", size = 1, slope = 1.5, lty = 2) +
  geom_abline(col = "black", size = 1, slope = 2) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Marriages versus Births in Taiwan Administrative Regions (2004 - 2016)")
```

When we plot the numbers of total births against those of marriages, the basic math behind Taiwan's dwindling birth rates and population growth becomes very clear. 

Over half of the points on the plot, especially those representing the largest numbers of births, fall below the grey dash line with a slope of 1.5. That means an overwhelming portion of marriages, on average, don't produce more than 1.5 children, quite possibly because more and more couples are either delaying childbearing plans or abandoning the idea altogether. To a typical 2-parent marriage, that replacement level fertility is below that at which a population exactly replaces itself from one generation to the next, not to mention the equally worrisome slide in marriage rate.

As is the case with many other developed countries nowadays, Taiwan's ongoing demographic crisis shows no sign of abating, and the fact that no point on the plot is above the steeper black line with a slope of 2 speaks volumes. In other words, virtually no administrative region across Taiwan has achieved a meaningfully large replacement level fertility to help stem the tide of nationwide population decline.

```{r}
ggplot(df.total.sm, aes(`No. of Natural Increases`, `No. of Social Increases`, col = `Adm. Names`, size = `Total No. of Increases`)) +
  geom_point(alpha = 0.6) +
  geom_abline(col = "black", size = 1) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Natural and Social Increases in Taiwan Administrative Regions (2004 - 2016)")
```

As seen in the plot above, the obvious pattern is that big cities like New Taipei City, Taichung City, Taipei City, and the emerging Taoyuan City have been steadily attracting more outside residents, all the while maintaining a comparatively health number of newborns. The rest of the country, however, has languished in prolonged population decline, with perennially low natural increases and often negative social increases.  

This seems to confirm with an overall irreversible trend of ongoing urbanization. 

```{r}
ggplot() +
  geom_bar(aes(x = Year, y = `Total No. of Transnational Marriages`, fill = `Adm. Names`), data = df.total.sm, stat = "identity") +
  scale_fill_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  scale_x_continuous(breaks = seq(2004, 2016, 1)) +
  theme(axis.text.x = element_text(hjust = 1, size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Transnational Marriages in Taiwan Administrative Regions (2004 - 2016)")

ggplot() +
  geom_bar(aes(x = Year, y = `Total No. of Transnational Divorces`, fill = `Adm. Names`), data = df.total.sm, stat = "identity") +
  scale_fill_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  scale_x_continuous(breaks = seq(2004, 2016, 1)) +
  theme(axis.text.x = element_text(hjust = 1, size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Transnational Divorces in Taiwan Administrative Regions (2004 - 2016)")
```

The 2 bar plots above show that transnational marriages saw a sharp decline from 2004 to 2006, but has been gradually edging back up in the past few years.

Interestingly and perhaps not coincidentally, the years during which the numbers of transnational marriages dropped to the lower point were also exactly the time when the numbers of transnational divorces soared to the top. 

The ebb and flow of transnational marriages and divorces nicely complement each other in our time frame.

```{r}
ggplot(df.total.sm, aes(`Total No. of Transnational Marriages`, `Total No. of Transnational Divorces`, col = `Adm. Names`)) +
  geom_point(alpha = 0.6) +
  geom_abline(col = "black", size = 1) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(hjust = 1, size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Transnational Marriages and Divorces in Taiwan Administrative Regions (2004 - 2016)")
```

When plotting the numbers of transnational marriages and divorces against each other, what is interesting is that the least populous regions see the their marriage-divorce ratio closest to 1:1, as their points cluster around the black, 45-degree parity line whereas the big metropolitan areas' points steer much further away from the 1:1 ratio. 

In other words, when it comes to transnational relationships in the more rural regions, there tends to be nearly as many marriages as divorces going around.  

```{r}
ggplot(df.total.sm, aes(`Total No. of Births by TW Moms`, `Total No. of Births by Non-TW Moms`, col = `Adm. Names`, size = `Total No. of Births`)) +
  geom_point(alpha = 0.6) +
  geom_abline(col = "black", size = 1, slope = 0.25) +
  geom_abline(col = "darkgrey", size = 1, slope = 0.15, lty = 2) +
  scale_color_manual(values = colors(length(unique(df.total.sm[, 2])))) +
  theme(axis.text.x = element_text(hjust = 1, size = 10), legend.position = "bottom") +
  theme(plot.margin = unit(c(0,0,0,0), "cm")) +
  ggtitle("Taiwanese and Non-Taiwanese Mothers in Taiwan Administrative Regions (2004 - 2016)")
```

The plot above shows births given by non-Taiwanese mothers remain still more prevalent in the less populated regions whose points stick closer to the black line with a slope of 0.25 (i.e. a 1:4 ratio between births by non-Taiwanese mothers and Taiwanese mothers). In contrast, most of the points for the more populated regions don't even touch the less steep grey line with a slope of 0.15 (i.e. a roughly 1:6.7 ratio between births by non-Taiwanese mothers and Taiwanese mothers). 

In other words, whereas those less populated regions naturally have lower numbers of newborns in absolute terms, their newborns are more likely to be given by non-Taiwanese mothers *in percentage terms* compared with the highly populated urban regions where Taiwanese mothers still account for the vast majority of births.  

In light of what we just noticed in the previous plot, the implication is worth pondering; transnational marriages seem less stable and enduring in the less populated, rural areas, but their births stand for a higher percentage of all local newborns than their counterparts in metropolitan regions. Besides seemingly contradictory, this phenomenon perhaps underscores a larger degree of tension and strain in transnational relationships within the more rural regions as well.

***

### 4. Summary

This analysis only presents a cursory look into some of the intriguing trends and changes of Taiwan population throughout more than the past decade. Further investigation may well uncover more insights on detailed demographic shifts and social changes. 

In addition, a host of many other types of public Taiwan data are freely available [here](http://sowf.moi.gov.tw/stat/month/list.htm) at the website of the Ministry of the Interior, Taiwan. 

> Anyway, the most interesting tidbits of our findings are summarized as follows:

- Consistent with the global sex ratio, Taiwan's male births have consistently outnumbered female births, albeit only slightly. ***The degree of outnumbering is notably much more prominent in the most metropolitan and populous regions***.

- ...However, Taiwanese men as a whole have been dying in markedly greater numbers than their opposite sex, ***especially in the most populous metropolitan regions as well***.

- As nationwide birth rate continues to plummet to new lows, ***the most populous, urban regions are not at all helping with their particularly low replacement level fertility***.

- ...and the picture gets grimmer as more and more people are moving to the cities.

- ***The ebb and flow in the numbers of transnational marriages and divorces have been mutually complementary***. A rise in transnational newlyweds has coincided nicely with a drop in marital separations, and vice versa. 

- ...but ***those cross-national relationships seem more shaky and fragile in the less populated, rural regions***, which have seen their transnational marriage-divorce ratio persistently close to 1:1 throughout the years.

- ...Meanwhile, also in those same regions, newborns delivered to non-Taiwanese mothers, as opposed to Taiwanese mothers, are much more prevalent. ***Combined with a less stable marital state, the social implication might be profound and worth contemplation***. 

***

```{r}
sessionInfo()
```

*Click [here](https://roywangtw.github.io) to link back to my GitHub Pages.*

[^1]: Here are the definitions of several potentially confusing phrases in the column names: (1) **illegit births**: out-of-wedlock births; (2) **TW Moms**: mothers of Taiwan nationality; (3) **Non-TW Moms**: mothers of nationalities other than Taiwan; (4) **M.HK.M. Moms**: mothers of China, Hong Kong, or Macau nationality; (5) **Foreigner Moms**: mothers of nationalities other than Taiwan, China, Hong Kong, and Macau.